#!/usr/local/bin/lasso9


define lspec_runFolder(d::dir) => {
    with f in #d->eachFile do => { lspec_runFile(#f) }
    with f in #d->eachDir  do => { lspec_runFolder(#f) }
}

define lspec_runFile(f::file) => {
    if(not #f->path->endsWith('.spec.inc')) => { return }
    
    sourcefile(#f->readString, #f->path, true, false)->invoke
}

if($argv->size == 1) => {
    if(not dir('./spec/')->exists) => {
        file_stderr->writeString(error_code_resNotFound + ':' + error_msg_resNotFound)
        sys_exit(1)
    }
    lspec_runFolder(dir('./spec/'))
}

with i in 2 to $argv->size by 1 do {
    local(f) = file($argv->get(#i))
    #f->isDir? lspec_runFolder(dir(#f->path)) 
             | sourcefile(#f->readString, #f->path, true, false)->invoke
}

lspec->stop